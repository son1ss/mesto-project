(()=>{"use strict";var e,t=document.querySelector(".profile__add-button"),n=document.querySelector(".profile__edit-button"),o=document.querySelector(".popup_type_profile-info"),r=o.querySelector(".popup__forms"),c=document.querySelectorAll(".popup__close-button"),u=document.querySelector(".profile__name"),i=document.querySelector(".profile__description"),a=document.querySelector(".popup_type_add-picture"),s=a.querySelector(".popup__forms"),l=document.querySelector(".popup_type_show-picture"),d=l.querySelector(".popup__image"),p=l.querySelector(".popup__caption"),f=document.querySelector(".elements__list"),m=document.querySelector(".profile__picture"),_=document.querySelector(".profile__picture-edit"),h=document.querySelector(".popup_type_edit-avatar"),v=h.querySelector(".popup__forms"),y=function(e){return e.querySelector(".popup__submit").textContent="Сохранение...",e.querySelector(".popup__submit")},S=function(e,t){"Escape"===e.key&&q(t)},b=function(e,t){e.target.className.includes("popup_active")&&q(t)},k=function(e){e.classList.add("popup_active"),document.addEventListener("keydown",(function(t){return S(t,e)})),e.addEventListener("click",(function(t){return b(t,e)}))},q=function(e){e.classList.remove("popup_active"),document.removeEventListener("keydown",(function(t){return S(t,e)})),e.removeEventListener("click",(function(t){return b(t,e)}))},E={baseUrl:"https://nomoreparties.co/v1/plus-cohort-24",headers:{authorization:"a43877ea-9dd0-4042-ac70-8f9f2817a645","Content-Type":"application/json"}},C=function(){return fetch("".concat(E.baseUrl,"/users/me"),{headers:E.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))},L=function(e){var t=document.querySelector(".photo-element").content.querySelector(".element").cloneNode(!0),n=t.querySelector(".element__photo"),o=t.querySelector(".element__remove"),r=t.querySelector(".element__like-button"),c=t.querySelector(".element__likes");return n.src=e.link,n.alt=e.name,t.querySelector(".element__title").textContent=e.name,C().then((function(n){e.owner._id===n._id?o.addEventListener("click",(function(){var n;(n=e._id,fetch("".concat(E.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:E.headers}).then((function(e){if(!e.ok)return Promise.reject("Ошибка ".concat(e.status))}))).then((function(){t.closest(".element").remove()})).catch((function(e){console.log(e)}))})):o.remove();var u=e.likes.map((function(e){return e._id}));c.textContent=u.length,u.includes(n._id)&&r.classList.add("element__like-button_active")})).catch((function(e){console.log(e)})),r.addEventListener("click",(function(){var t;r.classList.contains("element__like-button_active")?(t=e._id,fetch("".concat(E.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:E.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(user.status))}))).then((function(){r.classList.remove("element__like-button_active"),c.textContent--})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(E.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:E.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(user.status))}))}(e._id).then((function(){r.classList.add("element__like-button_active"),c.textContent++})).catch((function(e){console.log(e)}))})),n.addEventListener("click",(function(){!function(e){k(l),d.src=e.link,d.alt=e.name,p.textContent=e.name}(e)})),t},g=function(e,t){t.disabled=function(e){return e.some((function(e){return!e.validity.valid}))}(e)};fetch("".concat(E.baseUrl,"/cards"),{headers:E.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))})).then((function(e){e.forEach((function(e){var t;t=L(e),f.append(t)}))})).catch((function(e){console.log(e)})),C().then((function(e){u.textContent=e.name,i.textContent=e.about,m.src=e.avatar})).catch((function(e){console.log(e)})),n.addEventListener("click",(function(){k(o),r.elements.name.value=u.textContent,r.elements.description.value=i.textContent,g(Array.from(r.elements),o.querySelector(".popup__submit"))})),t.addEventListener("click",(function(){k(a),g(Array.from(s.elements),a.querySelector(".popup__submit"))})),r.addEventListener("submit",(function(e){e.preventDefault();var t=y(r);(function(e){return fetch("".concat(E.baseUrl,"/users/me"),{method:"PATCH",headers:E.headers,body:JSON.stringify(e)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))})({name:r.elements.name.value,about:r.elements.description.value}).then((function(e){u.textContent=e.name,i.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(){q(o),t.textContent="Сохранить"}))})),s.addEventListener("submit",(function(e){e.preventDefault();var t,n={name:s.elements.name.value,link:s.elements.link.value},o=y(s);(t=n,fetch("".concat(E.baseUrl,"/cards"),{method:"POST",headers:E.headers,body:JSON.stringify(t)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(user.status))}))).then((function(e){var t;t=L(e),f.prepend(t)})).catch((function(e){console.log(e)})).finally((function(){s.reset(),q(a),o.textContent="Создать"}))})),_.addEventListener("click",(function(){k(h)})),v.addEventListener("submit",(function(e){e.preventDefault();var t=y(v);(function(e){return fetch("".concat(E.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:E.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}))})(v.elements.link.value).then((function(e){return m.src=e.avatar})).catch((function(e){console.log(e)})).finally((function(){q(h),v.reset(),t.textContent="Сохранить"}))})),c.forEach((function(e){e.addEventListener("click",(function(){q(e.closest(".popup"))}))})),e={formSelector:".popup__forms",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_disabled",inputErrorClass:"popup__input_type_error"},Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);g(n,o),n.forEach((function(r){return r.addEventListener("input",(function(){var c=e.querySelector("".concat(t.inputSelector,"-error_type_").concat(r.name));!function(e,t,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(e,t,n){e.classList.remove(t),n.textContent=""}(e,t,n):function(e,t,n){e.classList.add(t),n.textContent=e.validationMessage}(e,t,n)}(r,t.inputErrorClass,c),g(n,o)}))}))}(t,e)}))})();